{"mappings":"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","sources":["node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","node_modules/@parcel/runtime-js/lib/runtime-7ad8fed8e4cbd280.js","src/actors/Actor.ts","src/actors/FPSViewer.ts","node_modules/@parcel/runtime-js/lib/helpers/bundle-url.js","node_modules/@parcel/runtime-js/lib/runtime-7a7229103e1e2616.js","src/actors/Mario.actor.ts","src/main.ts"],"sourcesContent":["\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"kyWCV\\\":\\\"index.4b2bdaa5.js\\\",\\\"C3Lgy\\\":\\\"Mario.b919b250.png\\\"}\"));","import { Point } from \"../types/Point\";\n\nexport interface IActor {\n  position: Point;\n  update: (delta: number) => void;\n  initialize?: () => void;\n  keyboard_event_down?: (key: string) => void;\n  keyboard_event_up?: (key: string) => void;\n  draw: (delta: number, ctx: CanvasRenderingContext2D) => void;\n}\n\nexport class Actor implements IActor {\n  position: Point;\n  constructor(position: Point) {\n    this.position = position;\n  }\n  update(delta: number) {}\n  draw(delta: number, ctx: CanvasRenderingContext2D) {}\n  keyboard_event(key: string) {}\n}\n","import { Actor } from \"./Actor\";\n\nexport class FPSViewer extends Actor {\n\tupdate() {}\n\tkeyboard_event() {}\n\tdraw(delta: number, ctx: CanvasRenderingContext2D) {\n\t\tconst fps = (1 / delta).toFixed(2);\n\t\tctx.font = \"15px Arial\";\n\t\tctx.fillStyle = \"black\";\n\t\tctx.fillText(`FPS:${fps}`, this.position.x, this.position.y);\n\t}\n}\n","\"use strict\";\n\nvar bundleURL = {};\n\nfunction getBundleURLCached(id) {\n  var value = bundleURL[id];\n\n  if (!value) {\n    value = getBundleURL();\n    bundleURL[id] = value;\n  }\n\n  return value;\n}\n\nfunction getBundleURL() {\n  try {\n    throw new Error();\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp):\\/\\/[^)\\n]+/g);\n\n    if (matches) {\n      // The first two stack frames will be this function and getBundleURLCached.\n      // Use the 3rd one, which will be a runtime in the original bundle.\n      return getBaseURL(matches[2]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n} // TODO: Replace uses with `new URL(url).origin` when ie11 is no longer supported.\n\n\nfunction getOrigin(url) {\n  var matches = ('' + url).match(/(https?|file|ftp):\\/\\/[^/]+/);\n\n  if (!matches) {\n    throw new Error('Origin not found');\n  }\n\n  return matches[0];\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\nexports.getOrigin = getOrigin;","module.exports = require('./helpers/bundle-url').getBundleURL('kyWCV') + require('./helpers/bundle-manifest').resolve(\"C3Lgy\");","import { Actor } from \"./Actor\";\n\nimport mario_spritesheet from \"../assets/Mario.png\";\n\nexport class Mario extends Actor {\n  public mario_img?: HTMLImageElement;\n  public frame_count = 0;\n  update(delta: number) {}\n\n  initialize() {\n    this.mario_img = new Image();\n    // esta linea es la que carga la imagen\n    this.mario_img.src = mario_spritesheet;\n\n    // esto es para comprobar que la imagen se ha cargado correctamente\n    this.mario_img.onload = () => {\n      console.log(\"Mario image loaded\");\n    };\n  }\n\n  draw(delta: number, ctx: CanvasRenderingContext2D) {\n    // Move to Actor origin\n    ctx.save();\n    ctx.translate(this.position.x, this.position.y);\n\n    //https://github.com/iluuu1994/Super-Mario-Bros/blob/master/Resources/sprite%20sheets/creatures/mario/Mario.plist\n    const mario_frames = [\n      { src_origin: { x: 4, y: 164 }, size: { x: 14, y: 15 } },\n      { src_origin: { x: 4, y: 212 }, size: { x: 12, y: 16 } },\n      { src_origin: { x: 28, y: 208 }, size: { x: 16, y: 16 } },\n    ];\n\n    // este if es por si la imagen no se ha cargado\n    if (this.mario_img) {\n      // https://developer.mozilla.org/es/docs/Web/API/CanvasRenderingContext2D/drawImage\n      let i = Math.floor(this.frame_count * 10);\n      let frame = mario_frames[i % mario_frames.length];\n      let scale = 10;\n      ctx.drawImage(\n        this.mario_img,\n        frame.src_origin.x,\n        frame.src_origin.y,\n        frame.size.x,\n        frame.size.y,\n        0,\n        0,\n        frame.size.x * scale,\n        frame.size.y * scale\n      );\n    } else {\n      // Draw the super mario actor\n      ctx.fillStyle = \"red\";\n      ctx.fillRect(0, 0, 100, 100);\n    }\n\n    ctx.restore();\n\n    this.frame_count += delta;\n  }\n}\n","import { Actor, IActor } from \"./actors/Actor\";\nimport { FPSViewer } from \"./actors/FPSViewer\";\nimport { Mario } from \"./actors/Mario.actor\";\n\nwindow.onload = () => {\n  var canvas = document.getElementById(\"canvas\") as HTMLCanvasElement;\n  var ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n\n  // Creamos los objetos que representaran los actores de nuestro juego\n  let fps = new FPSViewer({ x: 5, y: 15 });\n  let mario = new Mario({ x: 100, y: 100 });\n\n  // Declaramos el array de actores\n  let actors: Array<IActor> = [fps, mario];\n  // Inicializamos los actores si es necesario y está implementada\n  // la función initialize en el actor que vamos a pintar\n  actors.forEach((a) => a.initialize && a.initialize());\n\n  // Bucle de renderizado\n  let lastFrame = 0;\n  const render = (time: number) => {\n    let delta = (time - lastFrame) / 1000;\n\n    lastFrame = time;\n    actors.forEach((e) => e.update(delta));\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    actors.forEach((e) => {\n      ctx.save();\n      e.draw(delta, ctx);\n      ctx.restore();\n    });\n    window.requestAnimationFrame(render);\n  };\n\n  window.requestAnimationFrame(render);\n\n  document.body.addEventListener(\"keydown\", (e) => {\n    // console.log(e.key);\n    actors.forEach((actor) => {\n      if (actor.keyboard_event_down) {\n        actor.keyboard_event_down(e.key);\n      }\n    });\n  });\n  document.body.addEventListener(\"keyup\", (e) => {\n    // console.log(e.key);\n    actors.forEach((actor) => {\n      if (actor.keyboard_event_up) {\n        actor.keyboard_event_up(e.key);\n      }\n    });\n  });\n};\n"],"names":["$8b4d1930797b255e$export$6503ec6e8aabbaf","$8b4d1930797b255e$export$f7ad0328861e2f03","$8b4d1930797b255e$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","parcelRequire","register","JSON","parse","$8235678231353d24$export$f73d3eb6fd876d80","position","this","update","delta","draw","delta1","ctx","keyboard_event","key","$37691bb6273e74a0$export$13acb86b4b3ca30e","fps","toFixed","font","fillStyle","fillText","x","y","$f29cd6c67ea13581$export$bdfd709ae4826697","$f29cd6c67ea13581$var$bundleURL","$f29cd6c67ea13581$var$getBaseURL","url","replace","value","err","matches","stack","match","$f29cd6c67ea13581$var$getBundleURL","$a088107003e7e951$exports","getBundleURL","resolve","$caa30a5bdaa4e499$export$fc975b129559c2d","initialize","mario_img","Image","src","$parcel$interopDefault","onload","console","log","save","translate","mario_frames","src_origin","size","frame","Math","floor","frame_count","scale","drawImage","fillRect","restore","window","canvas","document","getElementById","getContext","actors","forEach","a","lastFrame","render","time","e","clearRect","width","height","requestAnimationFrame","body","addEventListener","actor","keyboard_event_down","keyboard_event_up"],"version":3,"file":"index.4b2bdaa5.js.map"}